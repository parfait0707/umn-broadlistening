`configs/hierarchical-example-polis.json` に設定可能なキーと、それらが影響を与えるファイルおよび処理をまとめたテーブルは以下の通りです。

| キー (Key)                            | 影響を受けるファイル (Affected File(s))                         | 影響を受ける処理/関数 (Affected Process/Function)                                                                                                                                                              | 説明 (Description)                                                                                                                                                                                                                                |
| :------------------------------------ | :-------------------------------------------------------------- | :--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| **トップレベル**                      |                                                                 |                                                                                                                                                                                                            |                                                                                                                                                                                                                                                   |
| `name`                                | `hierarchical_utils.py`, `hierarchical_aggregation.py`          | `update_status`, `hierarchical_aggregation`                                                                                                                                                                  | 実行/レポートの名前。出力JSONに含まれる。                                                                                                                                                                                                           |
| `question`                            | `hierarchical_utils.py`, `hierarchical_aggregation.py`          | `validate_config`, `update_status`, `hierarchical_aggregation`                                                                                                                                             | 処理対象の問い。必須。出力JSONに含まれる。                                                                                                                                                                                                        |
| `input`                               | `hierarchical_utils.py`, `steps/extraction.py`, `steps/hierarchical_aggregation.py` | `validate_config`, `initialization`, `extraction`, `add_original_comments`, `create_custom_intro`                                                                                              | 入力CSVファイル名（拡張子なし）。必須。`inputs/` ディレクトリから読み込まれる。                                                                                                                                                                   |
| `model`                               | `hierarchical_utils.py`, `steps/extraction.py`, `steps/hierarchical_initial_labelling.py`, `steps/hierarchical_merge_labelling.py`, `steps/hierarchical_overview.py` | `initialization`, `extraction`, `hierarchical_initial_labelling`, `hierarchical_merge_labelling`, `hierarchical_overview`                                                                              | デフォルトで使用するLLMモデル名。各ステップで `model` が指定されていない場合に使用される。                                                                                                                                                            |
| `intro`                               | `hierarchical_utils.py`, `steps/hierarchical_aggregation.py`    | `validate_config`, `create_custom_intro`, `hierarchical_aggregation`                                                                                                                                       | レポートの導入文。最終的なJSON出力の `config.intro` に加工されて含まれる。                                                                                                                                                                            |
| `is_pubcom`                           | `steps/hierarchical_aggregation.py`                             | `hierarchical_aggregation`                                                                                                                                                                                 | パブリックコメント形式のデータかどうかを示すフラグ（真偽値）。`True`の場合、元のコメントを含むCSV (`final_result_with_comments.csv`) が追加で出力される。指定がない場合、`hierarchical_utils.py` で `True` に設定される（要修正）。                |
| **`extraction` ステップ**             |                                                                 |                                                                                                                                                                                                            |                                                                                                                                                                                                                                                   |
| `extraction.workers`                  | `steps/extraction.py`                                           | `extraction`, `extract_batch`                                                                                                                                                                                | 意見抽出処理の並列ワーカー数。                                                                                                                                                                                                                |
| `extraction.limit`                    | `steps/extraction.py`, `steps/hierarchical_aggregation.py`    | `extraction`, `create_custom_intro`                                                                                                                                                                          | 処理する入力コメント数の上限。                                                                                                                                                                                                                |
| `extraction.properties`               | `steps/extraction.py`, `steps/hierarchical_aggregation.py`    | `_validate_property_columns`, `extraction`, `_build_property_map`                                                                                                                                            | 入力CSVから追加で読み込むカラム名のリスト。最終JSONの `propertyMap` に含まれる。                                                                                                                                                               |
| `extraction.categories`               | `steps/extraction.py`, `services/category_classification.py`, `steps/hierarchical_aggregation.py` | `extraction` (-> `classify_args`), `classify_args`, `_build_categories_string`, `_build_property_map`                                                                             | LLMによる追加カテゴリ分類の定義。キーがカテゴリ名、値が分類基準の辞書。最終JSONの `propertyMap` に含まれる。                                                                                                                                       |
| `extraction.category_batch_size`      | `services/category_classification.py`                           | `classify_args`                                                                                                                                                                                              | カテゴリ分類を行う際のバッチサイズ。                                                                                                                                                                                                              |
| `extraction.prompt`                   | `hierarchical_utils.py`, `steps/extraction.py`                  | `initialization`, `extract_batch`                                                                                                                                                                              | 意見抽出用のLLMプロンプト。指定がない場合は `prompts/extraction/default.txt` が使用される。                                                                                                                                                     |
| `extraction.model`                    | `hierarchical_utils.py`, `steps/extraction.py`                  | `initialization`, `extract_batch`                                                                                                                                                                              | 意見抽出に使用するLLMモデル名。指定がない場合はトップレベルの `model` が使用される。                                                                                                                                                           |
| `extraction.prompt_file`              | `hierarchical_utils.py`                                         | `initialization`                                                                                                                                                                                              | 意見抽出用のLLMプロンプトファイル名（拡張子なし）。`prompts/extraction/` ディレクトリから読み込まれる。`prompt` と `prompt_file` の両方が指定された場合の優先順位はコードに依存するが、通常は `prompt` が優先されるか、 `prompt_file` が無視される。 |
| **`embedding` ステップ**              |                                                                 |                                                                                                                                                                                                            |                                                                                                                                                                                                                                                   |
| `embedding.model`                     | `hierarchical_utils.py`, `steps/embedding.py`                   | `initialization`, `embedding`                                                                                                                                                                                | 意見のベクトル化に使用する埋め込みモデル名。                                                                                                                                                                                                          |
| **`hierarchical_clustering` ステップ** |                                                                 |                                                                                                                                                                                                            |                                                                                                                                                                                                                                                   |
| `hierarchical_clustering.cluster_nums` | `steps/hierarchical_clustering.py`                              | `hierarchical_clustering`, `hierarchical_clustering_embeddings`                                                                                                                                              | 階層クラスタリングで生成するクラスター数のリスト（昇順）。例: `[3, 6, 12]`。                                                                                                                                                                    |
| **`hierarchical_initial_labelling` ステップ** |                                                                 |                                                                                                                                                                                                            |                                                                                                                                                                                                                                                   |
| `hierarchical_initial_labelling.sampling_num` | `steps/hierarchical_initial_labelling.py`                 | `hierarchical_initial_labelling`, `initial_labelling`, `process_initial_labelling`                                                                                                                             | 初期ラベリングのために各クラスターからサンプリングする意見の数。                                                                                                                                                                                 |
| `hierarchical_initial_labelling.workers` | `steps/hierarchical_initial_labelling.py`                 | `hierarchical_initial_labelling`, `initial_labelling`                                                                                                                                                          | 初期ラベリング処理の並列ワーカー数。                                                                                                                                                                                                              |
| `hierarchical_initial_labelling.prompt` | `hierarchical_utils.py`, `steps/hierarchical_initial_labelling.py` | `initialization`, `process_initial_labelling`                                                                                                                                                                | 初期ラベリング用のLLMプロンプト。指定がない場合は `prompts/hierarchical_initial_labelling/default.txt` が使用される。                                                                                                                            |
| `hierarchical_initial_labelling.model` | `hierarchical_utils.py`, `steps/hierarchical_initial_labelling.py` | `initialization`, `process_initial_labelling`                                                                                                                                                                | 初期ラベリングに使用するLLMモデル名。指定がない場合はトップレベルの `model` が使用される。                                                                                                                                                           |
| `hierarchical_initial_labelling.prompt_file` | `hierarchical_utils.py`                                     | `initialization`                                                                                                                                                                                              | 初期ラベリング用のLLMプロンプトファイル名（拡張子なし）。`prompts/hierarchical_initial_labelling/` から読み込まれる。                                                                                                                                 |
| **`hierarchical_merge_labelling` ステップ** |                                                                 |                                                                                                                                                                                                            |                                                                                                                                                                                                                                                   |
| `hierarchical_merge_labelling.sampling_num` | `steps/hierarchical_merge_labelling.py`                   | `merge_labelling`, `process_merge_labelling`                                                                                                                                                                   | マージラベリングのために各クラスターからサンプリングする意見の数（下位レベルのラベルではなく、元の意見をサンプリング）。                                                                                                                            |
| `hierarchical_merge_labelling.workers` | `steps/hierarchical_merge_labelling.py`                   | `merge_labelling`                                                                                                                                                                                              | マージラベリング処理の並列ワーカー数。                                                                                                                                                                                                              |
| `hierarchical_merge_labelling.prompt` | `hierarchical_utils.py`, `steps/hierarchical_merge_labelling.py` | `initialization`, `process_merge_labelling`                                                                                                                                                                  | マージラベリング用のLLMプロンプト。指定がない場合は `prompts/hierarchical_merge_labelling/default.txt` が使用される。                                                                                                                              |
| `hierarchical_merge_labelling.model` | `hierarchical_utils.py`, `steps/hierarchical_merge_labelling.py` | `initialization`, `process_merge_labelling`                                                                                                                                                                  | マージラベリングに使用するLLMモデル名。指定がない場合はトップレベルの `model` が使用される。                                                                                                                                                           |
| `hierarchical_merge_labelling.prompt_file` | `hierarchical_utils.py`                                     | `initialization`                                                                                                                                                                                              | マージラベリング用のLLMプロンプトファイル名（拡張子なし）。`prompts/hierarchical_merge_labelling/` から読み込まれる。                                                                                                                                 |
| **`hierarchical_overview` ステップ**    |                                                                 |                                                                                                                                                                                                            |                                                                                                                                                                                                                                                   |
| `hierarchical_overview.prompt`        | `hierarchical_utils.py`, `steps/hierarchical_overview.py`       | `initialization`, `hierarchical_overview`                                                                                                                                                                    | 全体概要生成用のLLMプロンプト。指定がない場合は `prompts/hierarchical_overview/default.txt` が使用される。                                                                                                                                      |
| `hierarchical_overview.model`         | `hierarchical_utils.py`, `steps/hierarchical_overview.py`       | `initialization`, `hierarchical_overview`                                                                                                                                                                    | 全体概要生成に使用するLLMモデル名。指定がない場合はトップレベルの `model` が使用される。                                                                                                                                                           |
| `hierarchical_overview.prompt_file`   | `hierarchical_utils.py`                                         | `initialization`                                                                                                                                                                                              | 全体概要生成用のLLMプロンプトファイル名（拡張子なし）。`prompts/hierarchical_overview/` から読み込まれる。                                                                                                                                      |
| **`hierarchical_aggregation` ステップ** |                                                                 |                                                                                                                                                                                                            |                                                                                                                                                                                                                                                   |
| `hierarchical_aggregation.sampling_num` | `steps/hierarchical_aggregation.py`                             | (現状、コード内で直接的な影響はないように見えるが、将来的なサンプリング実装用かもしれない)                                                                                                                            | (説明保留)                                                                                                                                                                                                                                  |
| `hierarchical_aggregation.hidden_properties` | `steps/hierarchical_aggregation.py`                       | `_build_property_map`, (`_build_comments_value` ※コメントアウト中)                                                                                                                                          | 最終的なJSON出力の `propertyMap` でキーとしては保持するが、特定の値を持つargumentを除外したい場合などに使う想定？（現状は `propertyMap` の生成時に使われるのみ）。キーがプロパティ名、値が非表示にする値のリスト。                                   |

**補足:**

*   各ステップの `prompt`, `model`, `prompt_file` は、そのステップがLLMを使用する場合（`hierarchical_specs.json` で `use_llm: true` となっている場合）に設定可能です。
*   `hierarchical_utils.py` の `initialization` 関数内で、各ステップの設定が存在しない場合にデフォルト値が設定されるロジックがあります（例: `sampling_num`, `workers` など）。
*   `hierarchical_specs.json` に定義されていないキー（例: `is_pubcom`）も、 `hierarchical_utils.py` の `validate_config` でチェックされなければ、設定ファイルに追加してコード内で利用することが可能です。